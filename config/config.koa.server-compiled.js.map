{"version":3,"sources":["config.koa.server.js"],"names":[],"mappings":"AAAA;;AAGA;;AACA,OAAO,OAAP,GAAkB,UAAS,GAAT,EAAa;AAC3B,QAAI,QAAU,QAAQ,WAAR,CAAd;AAAA,QACI,QAAU,QAAQ,SAAR,CADd;AAAA,QAEI,SAAU,QAAQ,UAAR,CAFd;AAAA,QAGI,IAAU,QAAQ,QAAR,CAHd;AAAA,QAII,OAAU,QAAQ,MAAR,CAJd;AAAA,QAKI,OAAU,QAAQ,eAAR,CALd;AAAA,QAMI,MAAU,KAAK,GANnB;;AAQA;AACA,QAAI,UAAU,EAAd;AAAA,QAAkB,SAAS,EAA3B;AAAA,QAA+B,QAAQ,EAAvC;AAAA,QAA2C,eAAe,EAA1D;;AAEA,MAAE,IAAF,CAAO,OAAO,OAAd,EAAuB,UAAS,MAAT,EAAgB;AACrC,YAAI,cAAc,KAAK,IAAL,CAAU,QAAQ,GAAR,EAAV,EAAyB,SAAzB,EAAoC,MAApC,CAAlB;AAAA,YACI,aAAc,KAAK,cAAL,CAAoB,WAApB,CADlB;;AAGA,UAAE,IAAF,CAAO,UAAP,EAAmB,UAAS,GAAT,EAAa;AAC9B,gBAAI,iBAAiB,KAAK,IAAL,CAAU,WAAV,EAAuB,GAAvB,CAArB;;AAEA,gBAAI,kBAAkB,KAAK,cAAL,CAAoB,cAApB,CAAtB;;AAEA,gBAAG,IAAI,EAAJ,CAAO,QAAP,CAAH,EAAoB;;AAElB,wBAAQ,MAAR,IAAkB,EAAlB;;AAEA,oBAAI,gBAAgB,OAAhB,CAAwB,QAAxB,IAAoC,CAAC,CAAzC,EAA4C;AAC1C,2BAAO,IAAP,CAAY,MAAZ;AACA,4BAAQ,KAAK,IAAL,CAAU,QAAQ,GAAR,EAAV,EAAyB,6BAAzB,EAAwD,kBAAxD,CAAR,EAAqF,GAArF,EAA0F,OAA1F,EAAmG,MAAnG,EAA2G,WAA3G;AACD;AACF;AACF,SAdD;AAeD,KAnBD;;AAqBA;AACA,YAAQ,GAAR,CAAY,mDAAZ;;AAEA,YAAQ,GAAR,CAAY,kBAAZ,EAAgC,MAAhC;;AAEA;;AAEA;AACA;AACA;;AAEI;;;;;;;AAQC,4BAAD,CAA2B,KAA3B,CAAiC,OAAjC;AACA,SAAK,SAAL,CAAe,MAAf,EAAuB,KAAvB,CAA6B,QAA7B;AACA,QAAI,SAAS,QAAQ,QAAQ,GAAR,KAAgB,6BAAxB,CAAb;;AAGA;AACA;;;;;;;;;AASF;;;;;;;;;;;;;;;;AAiBE;;;;;;;;;;;;;;;;;AAiBA,WAAO,SAAP,CAAiB,IAAjB,CAAsB,CAAE,qCAAF,CAAtB,EAAiE,IAAjE,CAAsE,UAAU,IAAV,EAAgB;AAClF,YAAI,EAAJ,CAAO,2BAAP;AACA;AACA;AACZ;;;;AAIY;;;;;;AAQH,KAhBD;;AAkBJ,WAAO,GAAP;AACH,CAxHD","file":"config.koa.server-compiled.js","sourcesContent":["'use strict';\r\n\r\n\r\n/* CONFIGURATE RUN ENV */\r\nmodule.exports  = function(app){\r\n    var route   = require('koa-route'),\r\n        parse   = require('co-body'),\r\n        config  = require('./config'),\r\n        _       = require('lodash'),\r\n        path    = require('path'),\r\n        util    = require('./assets/util'),\r\n        log     = util.log;\r\n\r\n    // view engine setup ==============\r\n    var modules = {}, loaded = [], views = [], view_engines = [];\r\n\r\n    _.each(config.modules, function(module){\r\n      var module_path = path.join(process.cwd(), 'modules', module),\r\n          module_sub  = util.getDirectories(module_path);\r\n\r\n      _.each(module_sub, function(sub){\r\n        var module_subpath = path.join(module_path, sub);\r\n\r\n        var module_subchild = util.getDirectories(module_subpath);\r\n\r\n        if(sub.re(\"server\")){\r\n\r\n          modules[module] = {};\r\n\r\n          if (module_subchild.indexOf(\"routes\") > -1) {\r\n            loaded.push(module);\r\n            require(path.join(process.cwd(), 'modules/core/server/configs', 'core.koa.configs'))(app, modules, module, module_path);\r\n          }\r\n        }\r\n      });\r\n    });\r\n\r\n    // =================================\r\n    console.log(\"=================================================\");\r\n\r\n    console.log('content loaded: ', loaded);\r\n\r\n    // resolve 304 status code\r\n\r\n    /// error handlers\r\n    // development error handler\r\n    // will print stacktrace\r\n\r\n        /*\r\n        // if-none-match header vs disable('etag'), pages status seems going well with etag disabling\r\n        app.use(function(req, res, next) {\r\n          req.headers['if-none-match'] = 'no-match-for-this';\r\n          next();\r\n        });*/\r\n\r\n\r\n        ('NODE_ENV = development').chalk('green');\r\n        JSON.stringify(loaded).chalk('yellow');\r\n        var models = require(process.cwd() + '/modules/core/server/models');\r\n\r\n\r\n        // Some DATA-PRESET (pre-insert), e.g. add to assembly table\r\n        /*var buildTask = models.Assembly.create({\r\n          customer_id: 6,\r\n          number:'assy_02',\r\n          revision: 'rev_02',\r\n          unique_key: '_37R0KNO5B'\r\n        }, {\r\n          validate: true,\r\n          ignoreDuplicates: true\r\n        });*/\r\n      /*\r\n       var buildTask = models.Assembly.build({\r\n         customer_id: 6,\r\n         number:'assy_02',\r\n         revision: 'rev_02',\r\n         unique_key: '_37R0KNO5B'\r\n         });\r\n\r\n        var creTask = models.Assembly.create({\r\n            customer_id: 6,\r\n            number:'assy_02',\r\n            revision: 'rev_02',\r\n            unique_key: '_37R0KNO5B'\r\n        }).then(function(insertedAssembly){\r\n          console.log(insertedAssembly.dataValues);\r\n        });;*/\r\n\r\n        /*var equipmentTask = models.ECMS_Equipment.bulkCreate([{\r\n          id: 5,\r\n          asset_number: 'asset05',\r\n          location_id: 'geoLocation05',\r\n          model: 'someModel',\r\n          status: 2\r\n        },{\r\n          id: 6,\r\n          asset_number: 'asset06',\r\n          location_id: 'geoLocation06',\r\n          model: 'someModel',\r\n          status: 1\r\n        }], {\r\n          // validate: true,\r\n          ignoreDuplicates: true\r\n        });*/\r\n\r\n        models.sequelize.sync({ /*force: true, logging: console.log*/ }).then(function (task) {\r\n            log.ok('database sync successful.');\r\n            // buildTask.save();\r\n            // console.log(arguments);\r\n/*          var server = app.listen(app.get('port'), function() {\r\n                debug('Express server listening on port ' + server.address().port);\r\n            });*/\r\n\r\n            /*\r\n            // validOne\r\n            buildTask.save();\r\n\r\n\r\n            buildTask.then(function (task) {\r\n                task.save();\r\n            });*/\r\n        });\r\n\r\n    return app;\r\n};"]}